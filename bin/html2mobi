#!/usr/bin/env ruby

home = File.expand_path('~')
config_dir = home + '/.html2mobi'

unless File.directory? config_dir
    puts '创建配置目录：' + config_dir
    Dir.mkdir(config_dir)
end

if ARGV[0].nil?
    puts 'Usage: html2mobi url [path]'
    puts 'For Example: html2mobi http://lz.book.sohu.com/book-28153.html ./book'
    exit(1)
end

url = ARGV[0]
time = Time.new
path = config_dir + '/' + '__mobi__' + time.strftime("%Y_%m_%d_%H_%M_%S")

unless ARGV[1].nil?
    path = File.expand_path(ARGV[1])
end
puts '电子书存储目录：' + path

if File.file? path
    puts path + ' is a file, need a directory'
    exit(1)
end

unless File.directory? path
    Dir.mkdir(path)
end

if File.file? File.dirname(__FILE__) + '/../lib/html2mobi.rb'
    require File.dirname(__FILE__) + '/../lib/html2mobi.rb'
else
    require 'html2mobi'
end

if url.include? 'sohu'
    d = Html2mobi::Download_sohu.new url, path
    d.generate_mobi_book
else
    puts "currently only support suhu"
    exit(1)
end
